@model IEnumerable<AgriculturaWeb.Models.Empleado>

@{
    ViewBag.Title = "Empleados";
    var paginaActual = (int)ViewBag.PaginaActual;
    var totalPaginas = (int)ViewBag.TotalPaginas;
    string busqueda = ViewBag.Busqueda as string;
}

<!-- Mensaje de confirmación -->
@if (TempData["Mensaje"] != null)
{
    <div class="alert alert-success alert-dismissible fade show mt-3 shadow-sm" role="alert">
        <i class="fa-solid fa-circle-check me-2"></i>@TempData["Mensaje"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Encabezado -->
<div class="d-flex justify-content-between align-items-center mt-4 mb-4">
    <h3 class="text-success fw-bold">
        <i class="fa-solid fa-users me-2"></i>Lista de Empleados
    </h3>
    <div>
        <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary me-2">
            <i class="fa-solid fa-arrow-left"></i> Regresar al Panel
        </a>
        <a href="@Url.Action("Create", "Empleados")" class="btn btn-success">
            <i class="fa-solid fa-user-plus"></i> Nuevo Empleado
        </a>
    </div>
</div>

<!-- Buscador -->
<form method="get" class="mb-3">
    <div class="input-group">
        <input type="text" name="busqueda" value="@busqueda" class="form-control" placeholder="Buscar por nombre o apellido..." />
        <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-magnifying-glass"></i> Buscar
        </button>
    </div>
</form>

<!-- Tabla -->
@if (Model.Any())
{
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle text-center">
                    <thead class="table-success">
                        <tr>
                            <th>Nombres</th>
                            <th>Apellidos</th>
                            <th>DPI</th>
                            <th>Teléfono</th>
                            <th>Fecha Ingreso</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var e in Model)
                        {
                            <tr>
                                <td>@e.Nombres</td>
                                <td>@e.Apellidos</td>
                                <td>@e.DPI</td>
                                <td>@e.Telefono</td>
                                <td>@(e.FechaIngreso.HasValue ? e.FechaIngreso.Value.ToShortDateString() : "—")</td>
                                <td class="text-center">
                                    <a href="@Url.Action("Edit", new { id = e.IdEmpleado })" class="btn btn-outline-primary btn-sm me-2">
                                        <i class="fa-solid fa-pen-to-square"></i> Editar
                                    </a>
                                    @using (Html.BeginForm("Delete", "Empleados", new { id = e.IdEmpleado }, FormMethod.Post, new { onsubmit = "return confirm('¿Eliminar al empleado " + e.Nombres + "?');", style = "display:inline" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-outline-danger btn-sm">
                                            <i class="fa-solid fa-trash"></i> Eliminar
                                        </button>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Paginación -->
            <nav class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(paginaActual == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { busqueda, pagina = paginaActual - 1 })">Anterior</a>
                    </li>

                    @for (int i = 1; i <= totalPaginas; i++)
                    {
                        <li class="page-item @(i == paginaActual ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { busqueda, pagina = i })">@i</a>
                        </li>
                    }

                    <li class="page-item @(paginaActual == totalPaginas ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { busqueda, pagina = paginaActual + 1 })">Siguiente</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
}
else
{
    <div class="alert alert-warning text-center mt-4 shadow-sm">
        <i class="fa-solid fa-triangle-exclamation"></i> No se encontraron empleados.
    </div>
}

@section scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tableCard = document.querySelector('.card');
            if (tableCard) {
                tableCard.classList.add('animate__animated', 'animate__fadeIn');
            }
        });
    </script>
}
